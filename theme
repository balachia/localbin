#!/bin/sh

SCHEMES_DIR=$HOME/.local/src/iTerm2-Color-Schemes
XRDB_DIR=$SCHEMES_DIR/xrdb
OSC_PATH=$HOME/.local/bin

if [ "$1" = "-all" ]; then
    all=1
    shift
fi

theme="$1"
theme_name="$theme"

#theme_file=$SCHEMES_DIR/$theme
if [ "$theme" = "dark" ]; then
    theme_name=Pnevma
fi
if [ "$theme" = "light" ]; then
    theme_name=rainbow-light
fi

# set theme variables
xrdb_file="$XRDB_DIR/${theme_name}.xrdb"

# finally, set color scheme
#for tty in $(find -E /dev -maxdepth 1 -regex "/dev/ttys[0-9]{3}"); do
if [ $all ]; then
    echo "$theme" > $HOME/.theme

    # better osc code
    # TODO: the find call is HIGHLY os dependent
    #$OSC_PATH/xrdb2osc.sh "$xrdb_file" $(find -E /dev -maxdepth 1 -regex "/dev/ttys[0-9]{3}")
    $OSC_PATH/xrdb2osc.sh "$xrdb_file" $(find /dev -regex "/dev/pts/[0-9]+")

else
    $OSC_PATH/xrdb2osc.sh "$xrdb_file"
fi
